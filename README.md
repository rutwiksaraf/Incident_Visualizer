# Incident Visualization Application

This project provides a Flask-based web application for extracting, analyzing, and visualizing incidents from uploaded PDFs or URLs. The application uses machine learning techniques for clustering and generates interactive visualizations with Bokeh.

---

## Detailed Approach

### 1. **Data Extraction**

The first step involves obtaining incident data from either uploaded PDF files or URLs. This process includes:

- **URL Data Retrieval:**
  - The application fetches the data from the provided URL using the `urllib.request` library. This ensures that external PDF files can be accessed and downloaded for analysis.

- **PDF Parsing:**
  - The content of the PDF file is processed using the `PyPDF2` library, which extracts text from each page of the document. This text is then scanned for incident details such as:
    - **`Date_Time`:** The date and time of the incident.
    - **`Nature`:** The type or nature of the incident (e.g., burglary, accident).
    - **`Location`:** The place where the incident occurred.
  - The extracted data is structured into a list of dictionaries for further processing.

---

### 2. **Data Preprocessing**

Once the raw data is extracted, it undergoes a series of cleaning and transformation steps to prepare it for visualization:

- **Data Cleaning:**
  - Invalid or missing values in critical fields (like `Date_Time` or `Nature`) are identified and addressed.
  - Dates are parsed into a standard datetime format using `pandas.to_datetime`.

- **Structuring:**
  - The cleaned data is stored in a pandas DataFrame to enable efficient manipulation and analysis.

- **Normalization:**
  - The `Nature` column (representing the type of incident) is standardized by converting text to lowercase and removing leading/trailing spaces. This ensures uniformity in data.

- **Validation:**
  - If the data lacks sufficient diversity in the `Nature` column (e.g., only one type of incident), fallback visualizations are created to avoid errors.

---

### 3. **Visualization**

The cleaned data is visualized using interactive plots created with the `Bokeh` library. Three key types of visualizations are generated:

- **Clustering:**
  - **Purpose:** To group incidents based on the similarity of their nature.
  - **Method:**
    - The `Nature` column is vectorized using TF-IDF, which converts text data into numerical features.
    - K-means clustering groups similar incidents into clusters.
    - PCA (Principal Component Analysis) reduces the dimensionality of data to 2D for visualization.
  - **Plot:** An interactive scatter plot is created, where each cluster is assigned a unique color.

- **Bar Plot:**
  - **Purpose:** To show the count of incidents by type.
  - **Method:** The `Nature` column is grouped and aggregated to count the occurrences of each type.
  - **Plot:** A bar plot visualizes the top 10 incident types, providing an overview of the most frequent issues.

- **Time Series:**
  - **Purpose:** To track the number of incidents over time.
  - **Method:** The `Date_Time` column is grouped by date, and the number of incidents is counted for each day.
  - **Plot:** A time-series plot displays the daily incident count, highlighting patterns or trends over time.

---

### 4. **Web Application**

The final step is integrating the entire workflow into a user-friendly web interface using the Flask framework:

- **User Interaction:**
  - Users can either upload PDF files or provide URLs for analysis.
  - Errors in data extraction or missing input are gracefully handled, with meaningful error messages displayed.

- **Visualization Display:**
  - The visualizations generated by `Bokeh` are embedded into HTML templates.
  - The interactive plots allow users to explore the data in detail, with hover tools providing additional information.

- **Scalability:**
  - The modular design ensures that the application can be extended with additional visualizations or data sources in the future.

---


---

## Function Overview

### **Main Application (`main.py`)**

#### `index()`
- **Purpose:** 
  Manages the home page where users upload PDF files or provide URLs for data extraction.
- **Key Steps:**
  1. **Input Handling:**
     - Reads URLs and uploaded PDF files from the user input form.
  2. **Data Processing:**
     - For each URL, calls `fetchIncidents` to download the PDF and `extractIncidents` to parse and extract incident data.
     - For each uploaded file, directly calls `extractIncidents` to process the content.
  3. **Error Management:**
     - Collects any errors during URL fetching or file processing and displays them to the user.
  4. **Session Storage:**
     - Stores the extracted incidents in the Flask session for use on the next page.
  5. **Redirection:**
     - Redirects the user to the `visuals` route for visualization.
  
#### `visuals()`
- **Purpose:** 
  Handles the generation and display of visualizations for the extracted incidents.
- **Key Steps:**
  1. **Data Retrieval:**
     - Retrieves the incident data stored in the Flask session.
  2. **Visualization Generation:**
     - Calls `create_visualizations` to generate interactive Bokeh plots.
  3. **Error Handling:**
     - Displays a detailed error message if the visualization generation fails.
  4. **Page Rendering:**
     - Embeds the generated plots into an HTML template for display.

---

### **Fetch Incidents (`fetch_incidents.py`)**

#### `fetchIncidents(url)`
- **Purpose:**
  Downloads a PDF file from the specified URL.
- **Key Steps:**
  1. **HTTP Request:**
     - Sends a GET request to the URL with appropriate headers to mimic a browser request.
  2. **File Retrieval:**
     - Reads the PDF content from the response and returns it as binary data.
  3. **Error Handling:**
     - Catches and raises HTTP or URL errors if the request fails.

---

### **Extract Incidents (`extract_incidents.py`)**

#### `extractIncidents(data)`
- **Purpose:**
  Parses PDF data and extracts structured information about incidents.
- **Key Steps:**
  1. **PDF Parsing:**
     - Reads the binary PDF data using `PyPDF2` and extracts text from each page.
  2. **Data Extraction:**
     - Searches the extracted text for patterns matching incident details (e.g., `Date_Time`, `Nature`, `Location`).
  3. **Data Formatting:**
     - Returns a list of dictionaries containing structured incident data.
  4. **Error Handling:**
     - Handles errors in PDF parsing and returns an empty list if parsing fails.

---

### **Data Visualization (`data_visualizer.py`)**

#### `create_visualizations(incidents)`
- **Purpose:**
  Creates interactive Bokeh plots to visualize incident data.
- **Key Steps:**
  1. **Data Preparation:**
     - Converts the incidents list into a pandas DataFrame and preprocesses key columns (`Date_Time` and `Nature`).
  2. **Clustering:**
     - Uses TF-IDF vectorization to analyze the `Nature` column and applies k-means clustering to group incidents.
     - Reduces the data to two dimensions using PCA for visualization.
  3. **Plot Generation:**
     - **Clustering Plot:** Displays incidents grouped by their cluster with unique colors.
     - **Bar Plot:** Shows the top 10 incident types based on frequency.
     - **Time-Series Plot:** Visualizes the number of incidents over time.
  4. **Embedding:**
     - Returns Bokeh script and div components for embedding in an HTML page.

#### `_create_fallback_visualization(df)`
- **Purpose:**
  Generates simpler visualizations if the data lacks sufficient variety for clustering.
- **Key Steps:**
  1. **Time-Series Plot:**
     - Plots the number of incidents over time using the `Date_Time` column.
  2. **Bar Plot:**
     - Displays a bar plot of incident counts by nature.
  3. **Embedding:**
     - Combines the plots into a single layout and returns the components for embedding.

---

### **Additional Notes**

- **Error Handling:**
  - Functions include robust error handling, with detailed tracebacks for debugging in case of failures.
  
- **Dynamic Adaptation:**
  - The clustering algorithm and visualizations adjust dynamically based on the diversity of the `Nature` column.

- **User Experience:**
  - Interactive plots enhance user engagement, with hover tools providing additional insights into the data.

---

## Installing Dependencies

To install all the required dependencies for this project, run the following commands in your terminal or command prompt:

``` pip install Flask  ```
``` pip install pandas ```
``` pip install PyPDF2 ```
``` pip install scikit-learn ```
``` pip install bokeh==3.2.1 ```
``` pip install urllib3 ```
``` pip install matplotlib seaborn ``` 

## File Descriptions

- **main.py:** Main Flask application that handles user input, processes incidents, and renders visualizations.
- **fetch_incidents.py:** Fetches incident data from provided URLs.
- **extract_incidents.py:** Extracts structured incident details from PDF data.
- **data_visualizer.py:** Contains logic to generate visualizations using Bokeh for incident data (clustering, bar plot, and time-series plot).

## How to run the code

``` python main.py ```

Open a web browser and navigate to http://127.0.0.1:5000 to access the application.


## Assumptions

1. **Data Format**:
   - The input PDFs are assumed to contain text-based data that can be extracted using `PyPDF2`.
   - Incident records are assumed to follow a specific format (e.g., `Date_Time`, `Nature`, `Location`, `ORI`) within the extracted text.

2. **PDF Content**:
   - The PDFs processed must contain incident data that matches the expected structure. If the structure is significantly different, the extraction may fail.

3. **Data Consistency**:
   - The `Nature` and `Date_Time` fields should be consistent and in the correct format for accurate visualization and analysis.

4. **Cluster Number Limit**:
   - The code assumes that there are at least two unique incident types for meaningful clustering. If there is only one unique incident type, fallback visualizations will be used.


---

## Known Bugs and Issues

1. **Empty Graphs**:
   - In some cases, the generated graphs may appear empty if the `Nature` column data is not sufficiently diverse or the data preprocessing fails.
   - If the clustering does not yield useful groups, an empty graph might be displayed instead of valid visualizations.

2. **PDF Extraction Issues**:
   - `PyPDF2` may not be able to extract data from some PDF files if they are encrypted, contain scanned images, or have an unsupported format.
   - The extraction logic may fail if the text extraction is inconsistent across different PDFs, leading to missing or incomplete incident data.

3. **Error Handling**:
   - While error messages are displayed when something goes wrong, some errors (especially those related to the structure of the incident data) may not be fully handled, leading to uninformative or generic messages.
   
4. **Cluster Labels**:
   - If the number of unique incident types is low (less than 2), the clustering process will not produce meaningful results, and the fallback visualizations will be shown.

5. **Data Inconsistency**:
   - If the incident data is inconsistent (e.g., missing required fields like `Date_Time` or `Nature`), the application may not be able to process it correctly, leading to empty plots or errors.





